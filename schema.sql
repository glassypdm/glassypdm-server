CREATE TABLE IF NOT EXISTS block(hash TEXT PRIMARY KEY NOT NULL, s3key TEXT NOT NULL);

CREATE TABLE IF NOT EXISTS chunk(cid INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, frid INTEGER NOT NULL, chunknumber INTEGER NOT NULL, hash TEXT NOT NULL);

CREATE TABLE IF NOT EXISTS 'commit'(cid INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, projectid INTEGER NOT NULL, userid TEXT NOT NULL, comment TEXT NOT NULL, numfiles INTEGER NOT NULL, timestamp DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL);

CREATE TABLE IF NOT EXISTS file(fid INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, pid INTEGER NOT NULL, path TEXT NOT NULL);

CREATE TABLE IF NOT EXISTS filerevision(frid INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, fid INTEGER NOT NULL, commitid INTEGER NOT NULL, numchunks INTEGER NOT NULL, changetype INTEGER NOT NULL);

CREATE TABLE IF NOT EXISTS project(pid INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, title TEXT NOT NULL, teamid INTEGER NOT NULL, basecommit INTEGER NOT NULL);

CREATE TABLE IF NOT EXISTS projectpermission(userid TEXT NOT NULL, projectid INTEGER NOT NULL, level INTEGER NOT NULL, PRIMARY KEY (userid, projectid));

CREATE TABLE IF NOT EXISTS team(teamid INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, name TEXT NOT NULL UNIQUE, planid INTEGER DEFAULT 0);

CREATE TABLE IF NOT EXISTS teampermission (userid TEXT NOT NULL, teamid INTEGER NOT NULL, level INTEGER NOT NULL, PRIMARY KEY (userid, teamid));